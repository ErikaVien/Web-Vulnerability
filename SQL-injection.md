# SQL 注入/ SQL injection 
-	Web 应用程序对用户输入数据的合法性没有判断或过滤不严
-	Web应用程序三层结构：
  
**视图层（浏览器/browser）+ 业务逻辑层（服务器/server） + 数据访问层(数据库/database)**
1.	数据库类型 : MySQL, MSSQL, Oracle, Access, etc
2.	提交方式 : GET, POST, COOKIE, REQUEST, HTTP header, etc
3.	数据类型 : 数字型， 字符型, etc
4.	查询方式 : select, insert, update, delete, order by
5.	回显/盲注 : 回显注入，无回显注入，延时注入，布尔(Boolean)注入
6.	WAF绕过 : 更改提交方法，大小写混合，解密编码类，注释符混用，等价函数替换，特殊符号混用，etc
7.	注入方式 : 加密注入，JSON注入, LADP注入 ,二次注入，堆叠注入
8.	防御方案 : 代码加载过滤， WAF产品部署

### SQL注入流程:
1.	判断注入点 : 有报错就有注入点，没报错没注入点
2.	猜解列名数量order by
3.	报错猜解，判断回显点union
4.	信息收集:  version(),database()
5.	使用对应SQL语句执行注入查询

**列如：** </br>

**从information_schema.table查找表名** </br>
数据库名：security </br>
查询security库里所有表名：group_concat(table_name) </br>
union select 1, table_name, 3 from information_schema.table where table_schema = “security”; </br>
**如何查表名有哪些字段？**</br>
表=users</br>
union select 1, group_concat(column_name), 3 from information_schema where table_name=”users”; </br>
users字符可转行16进制=0x7573657273 </br>
**username password 字段数据** </br>
select username,password from users </br>
0x3a 代表分号符(:) </br>
union select 1,2,(select group_concat(username,0x3a,password)from users) </br>

**数据库服务器默认自带的系统库：** 类似身份证
1.	information-schema
2.	performance-schema
3.	mysql
4.	sys

### **SQL注入之高权限注入**
-	多个网站可共享mysql服务器, 列如网站A和网站B共享同一个数据库服务器，数据库服务器里存着网站A和网站B的数据库
-	SQL 注入可以访问别的网站的数据库但得获得高权限来访问
-	MySQL 存在4个控制权限的表:
  1. user表 (服务器，最大权限)
  2. db 表 （数据库，权限大）
  3. tables_priv表 （表，权限小）
  4. column_priv表 （字段，最小权限）
-	网站高权限可：访问，设置，添加，更改权限，etc

### SQL注入之文件读写
secure_file_priv = 读写权限 ：可导出文件的权限，远程可更改此文件 </br>
secure-file_priv = NULL 代表没权限 </br>
-	Root权限可读写：
1.	用户信息：账号，密码
2.	配置信息：写入：木马，后门backdoor
读取文件：load_file()

### SQL注入之数据类型
1.	数据型注入
2.	字符型注入
3.	搜索型 ：like模糊查询 – select * from user where username like ‘%D%’ 
4.	xx型
like 只要某个字符里有就会被搜索出来
% % 通配符
% ‘闭合符
\# 注释符
SQL注入之数据提交方式
1.	GET ：通过url传递数据至后端，常见的，数据不敏感，安全性低，速度快，长度有限2kb
2.	POST : 直接传递数据给服务器，安全性高，速度慢，长度不限
3.	REQUEST = GET/POST
$username = $_REQUEST\[‘username’];
SQL注入查询方式
1.	select查询
2.	delete删除数据
3.	insert插入数据 ：insert into user(id,name,pass) value(1,’david,’,’1234’)
4.	update 更新数据

### SQL 注入之盲注报错
-	强制性报错；报错回显

### SQL注入之延时注入
-	sleep()
-	If()
-	mid(a,b,c)
-	sub

### SQL注入加密解密注入
-利用base64,etc加密解密

### SQL注入之堆叠注入
-	一个sql语句后再加多个语句： select * from username; select * from emails;

### SQL注入之WAF绕过
-	大小写绕过：union->UnIoN
-	编码绕过: 使用URL编码，Unicode编码，十六进制编码，Hex编码等
-	双写绕过 ：UNIunionON
-	换行绕过 : select from user where username \n union select
-	注释符内联 ： union select =/*!union*/ select
-	同义词替换 ： or ||, and &&
-	HTTP参污染

### SQL注入基础防御
1.	利用魔术引号 = magic_quotes_gpc : PHP 脚本的数据进行转义的过程；url里自动加 斜杠
PHP里自带的函数：php.ini
可更改或添加:
magic_quotes_gpc=on
magic_quotes_gpc=off
2.	PHP 内置函数:</br>
- 做数据库型的过滤
    -	is_int()
    -	addslashes()
    -	mysql_escape_string() </br>
- 自定义关键字：str_replace()
3.	安全防御软件WAF

