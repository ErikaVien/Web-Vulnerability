## XXE (XML External Entity Injection) XML 外部实体注入
### XXE 漏洞
- web应用的脚本代码没有限制XML引入外部实体而导致用户可插入一个外部实体，并且其中内容会被服务器端执行
- 案件：微信支付XXE漏洞

### XXE 危害：
- 任意文件读取
- 系统命令执行
- 内网漏洞探测 - 返回没显示代表端口有运行，返回报错端口没运行
- 攻击内部网站

### XXE 防御
- 加入禁用实体解析代码
- 过滤用户提交的XML数据，如过滤符号
- 使用WAF, 如mod_security
- PHP: libxml_disable_entity_loader(true);
- Java

DocumentBuilderFactory dbf

=DocumentBuilderFactory.newInstance();

dbf.setExpandEntityReferences(false);

- Python: 

from lxml import etree

xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))

**直打：XXE靶场**
1. 确定使用XML传输数据，Burp Suite抓包
2. 发送Repeater
3. 添加DTD应用外部文档
4. send取响应

**盲打 ：DNSlog, http接口参数写入文件**

### XML (Extensible Markup Language) 可扩展标记的语言
- 可自定义
- 做配置文件
- 交换数据

### XML格式：
- XML文档必须有根元素，关闭标签
- 标签大小敏感
- 属性必须加引号
- 元素必须被正确的嵌套

### DTD (Document Type Definition) 文档类型定义
- 可独立，也可以用在html里
- 元素ELEMENT： <!DOCTYPE TranInfo[
- 实体ENTITY :  <!DOCTYPE name[
- 内部实体internal entity ： 支持协议php, file, http </br>
\<people> </br>
   \<name>wuya\</name> </br>
   \<area>changsa\</area> </br>
\</people>
- 外部实体external entity ：\<!ENTITY xxe SYSTEM "file:///D:/test/test.dtd">]>

**expect : xml扩展** 
- 可用于执行命令
<! ENTITY xxe SYSTEM "expect://ipconfig">]>
